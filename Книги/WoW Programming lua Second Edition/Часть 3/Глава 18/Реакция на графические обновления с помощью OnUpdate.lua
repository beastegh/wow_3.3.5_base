üìò –†–µ–∞–∫—Ü–∏—è –Ω–∞ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é OnUpdate

  –•–æ—Ç—è –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –∫–æ–¥–∞ –≤ World of Warcraft –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º–µ —Å–æ–±—ã—Ç–∏–π, –±—ã–≤–∞—é—Ç —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –∫–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫–æ –≤—Ä–µ–º–µ–Ω–∏).

  –í World of Warcraft –Ω–µ—Ç –ø—Ä–æ—Å—Ç–æ–π API-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–∫–æ–π –ª–æ–≥–∏–∫–∏, –æ–¥–Ω–∞–∫–æ —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–æ–≤ OnUpdate.

  –ù–∞–ø—Ä–∏–º–µ—Ä, OnUpdate-—Å–∫—Ä–∏–ø—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á:
    –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è
    –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏—Ö —Å–æ–±—ã—Ç–∏–π –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    –ü–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  
  –í —ç—Ç–æ–π –≥–ª–∞–≤–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, –ª–µ–∂–∞—â–∞—è –≤ –æ—Å–Ω–æ–≤–µ OnUpdate, –∏ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ—Å—Ç—ã—Ö –∞–¥–¥–æ–Ω–æ–≤, —Ä–µ–∞–ª–∏–∑—É—é—â–∏—Ö –∫–∞–∂–¥—ã–π –∏–∑ —ç—Ç–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

üìò –ü–æ–Ω–∏–º–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

  –û–¥–∏–Ω –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –∏–≥—Ä–µ, —Ç–∞–∫–æ–π –∫–∞–∫ World of Warcraft, ‚Äî —ç—Ç–æ —á–∞—Å—Ç–æ—Ç–∞ –∫–∞–¥—Ä–æ–≤ (FPS), –∏–∑–º–µ—Ä—è–µ–º–∞—è –≤ –∫–∞–¥—Ä–∞—Ö –≤ —Å–µ–∫—É–Ω–¥—É. –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω —Å —ç—Ç–æ–π —á–∞—Å—Ç–æ—Ç–æ–π, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∏ –∏–≥—Ä–æ–≤–æ–º –º–∏—Ä–µ.

  –í—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å —Å–≤–æ—é —Ç–µ–∫—É—â—É—é —á–∞—Å—Ç–æ—Ç—É –∫–∞–¥—Ä–æ–≤ (—Å–º. —Ä–∏—Å—É–Ω–æ–∫), –Ω–∞–∂–∞–≤ Ctrl+R.

  –ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–µ —ç–∫—Ä–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç OnUpdate –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–∏–º–æ–≥–æ —Ñ—Ä–µ–π–º–∞ (–¥–∞–∂–µ –µ—Å–ª–∏ —É –Ω–µ–≥–æ –Ω–µ—Ç –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤). –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤ OnUpdate –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∞—Ä–≥—É–º–µ–Ω—Ç, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—à–ª–æ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞.

  –í–º–µ—Å—Ç–µ –≤—Å—ë —ç—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–≥–æ, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞.
    üëâ https://live.staticflickr.com/65535/54650597032_0f8d51abae_t.jpg

üìò –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é OnUpdate

  –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ —Å–ª—É—á–∞–π–Ω—É—é –∫–æ–ª–∫–æ—Å—Ç—å), –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∏—Å–ø–æ–ª—å–∑—É—é—â—É—é OnUpdate, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥ –ø–æ–∑–∂–µ. –í–≤–µ–¥–∏—Ç–µ –≤ –∏–≥—Ä–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:
  
    if not DelayFrame then
      DelayFrame = CreateFrame("Frame")
      DelayFrame:Hide()
    end
  
    function Delay(delay, func)
      DelayFrame.func = func
      DelayFrame.delay = delay
      DelayFrame:Show()
    end

    DelayFrame:SetScript("OnUpdate", function(self, elapsed)
      self.delay = self.delay - elapsed
       
      if self.delay <= 0 then
        self:Hide()
        self.func()
      end
    end)
    
  –≠—Ç–æ—Ç –∫–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é Delay, –ø—Ä–∏–Ω–∏–º–∞—é—â—É—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥ –∏ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –ø–æ—Å–ª–µ —ç—Ç–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏. –§—Ä–µ–π–º DelayFrame —Å–ª–µ–¥–∏—Ç –∑–∞ –ø—Ä–æ—à–µ–¥—à–∏–º –≤—Ä–µ–º–µ–Ω–µ–º —Å –ø–æ–º–æ—â—å—é OnUpdate –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ–≥–¥–∞ –≤—Ä–µ–º—è –∏—Å—Ç–µ–∫–∞–µ—Ç.

  –¢–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Delay ‚Äî –Ω–µ–±–æ–ª—å—à–æ–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–ª–∫–∏–µ —Ä–µ–ø–ª–∏–∫–∏ –≤ –±–æ—é:

    if not TauntFrame then
      TauntFrame = CreateFrame("Frame")
    end

    local tauntMessages = {
      "Is that the best you can do?",
      "My grandmother can hit harder than that!",
      "Now you're making me angry!",
      "Was that supposed to hurt?",
      "Vancleef pay big for your head!",
      "You too slow! Me too strong!",
    }

    TauntFrame.CHANCE = 0.5 -- —à–∞–Ω—Å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
    TauntFrame.DELAY = 3.0 -- –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º

    local isDelayed = false

    local function sendTauntMessage()
      local msgId = math.random(#tauntMessages)
      SendChatMessage(tauntMessages[msgId], "SAY")
      isDelayed = false
    end

    TauntFrame:RegisterEvent("UNIT_COMBAT")

    TauntFrame:SetScript("OnEvent", function(self, event, unit, action, ...)
      if unit == "player" and action ~= "HEAL" and not isDelayed then
        local chance = math.random(100)

        if chance <= (100 * self.CHANCE) then
          local delayTime = math.random() * self.DELAY
          Delay(delayTime, sendTauntMessage)
          isDelayed = true
        end
      end
    end)

  üëâ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –∫–æ–¥:
    –°–æ–∑–¥–∞—ë—Ç —Ñ—Ä–µ–π–º TauntFrame –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π.
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–ª–∫–æ—Å—Ç–µ–π.
    –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: 
      CHANCE (—à–∞–Ω—Å –Ω–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ)
      DELAY (–∑–∞–¥–µ—Ä–∂–∫–∞).
    –°–æ–∑–¥–∞—ë—Ç —Ñ—É–Ω–∫—Ü–∏—é sendTauntMessage, –≤—ã–±–∏—Ä–∞—é—â—É—é —Å–ª—É—á–∞–π–Ω—É—é —Ä–µ–ø–ª–∏–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—â—É—é –µ—ë –≤ —á–∞—Ç.

  –ü—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è UNIT_COMBAT, –µ—Å–ª–∏ –∞—Ç–∞–∫–æ–≤–∞–Ω –∏–≥—Ä–æ–∫ –∏ –Ω–µ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏, —Å–∫—Ä–∏–ø—Ç —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —à–∞–Ω—Å–æ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ—Ä–∞–∑—ã —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π.

  –ù–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –≤–∏–¥–Ω–æ, –∫–∞–∫ —ç—Ç–∏ —Ñ—Ä–∞–∑—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä—è–º–æ –≤ –±–æ—é:
  üëâ https://live.staticflickr.com/65535/54651456726_0b3d49cee5_m.jpg

  –¢—ã –º–æ–∂–µ—à—å –º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã TauntFrame.CHANCE –∏ TauntFrame.DELAY –ø—Ä—è–º–æ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∞–¥–¥–æ–Ω–∞, –ø–æ–¥–±–∏—Ä–∞—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–¥ —Å–µ–±—è.
  
üìò –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

  –°–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ—Å—Ç–æ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–≥—Ä–æ–∫–∞ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –µ–≥–æ, –∫–æ–≥–¥–∞ –æ—Å—Ç–∞—ë—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ BAG_UPDATE, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–∞–µ—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ —Å—É–º–∫–∞—Ö –∏–≥—Ä–æ–∫–∞.
  
  if not BagWatchFrame then
  	BagWatchFrame = CreateFrame("Frame")
  end
  
  BagWatchFrame.WARN_LEVEL = 0.2
  BagWatchFrame.message = "You are running low on bag space!"
  BagWatchFrame.fullMessage = "Your bags are full!"
  
  local function bagWatch_OnEvent(self, event, bag, ...)
  	local maxSlots, freeSlots = 0, 0

  	for idx = 0, 4 do
  		maxSlots = maxSlots + GetContainerNumSlots(idx)
  		freeSlots = freeSlots + GetContainerNumFreeSlots(idx)
  	end
  	
  	local percFree = freeSlots / maxSlots
  	local msg
  
  	if percFree == self.percFree then
  		-- –ù–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ
  	elseif percFree == 0 then
  		msg = BagWatchFrame.fullMessage
  	elseif percFree <= self.WARN_LEVEL then
  		msg = BagWatchFrame.message
  	end
  
  	if msg then
  		RaidNotice_AddMessage(RaidWarningFrame, msg, ChatTypeInfo["RAID_WARNING"])
  	end
  
  	self.percFree = percFree
  end
  
  BagWatchFrame:RegisterEvent("BAG_UPDATE")
  BagWatchFrame:SetScript("OnEvent", bagWatch_OnEvent)

  üëâ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –∫–æ–¥:
    –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –∏–≥—Ä–æ–∫–∞, –µ—Å–ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —è—á–µ–µ–∫ –≤ —Å—É–º–∫–∞—Ö –º–µ–Ω—å—à–µ 20%.
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–±—â–µ–µ –∏ —Å–≤–æ–±–æ–¥–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—Ç–æ–≤ —á–µ—Ä–µ–∑ GetContainerNumSlots() –∏ GetContainerNumFreeSlots().
    –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é RaidNotice_AddMessage().
  
  –ü—Ä–∏–º–µ—Ä –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
    üëâ https://live.staticflickr.com/65535/54651824565_c26d9e120b_w.jpg
    
  üëâ –ü—Ä–æ–±–ª–µ–º–∞:
    –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è (Equipment Manager) ‚Äî —Å–∏—Å—Ç–µ–º—É, –ø–æ–∑–≤–æ–ª—è—é—â—É—é —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –Ω–∞–±–æ—Ä—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å —Ç–µ–º, —á—Ç–æ —ç—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –ø–æ–¥—Ä—è–¥. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ BAG_UPDATE —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–Ω–æ–≥–æ —Ä–∞–∑ –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫, –∫–æ–≥–¥–∞ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞ –±—ã—Å—Ç—Ä–æ –Ω–∞–¥–µ–≤–∞–µ—Ç—Å—è –∏–ª–∏ —Å–Ω–∏–º–∞–µ—Ç—Å—è.
  
  –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ (–ø–∏–Ω–≥–∞), –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤, —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –º–Ω–æ–∂–µ—Å—Ç–≤—É –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –ß—Ç–æ–±—ã —Ä–µ—à–∏—Ç—å —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É ‚Äî –º–æ–∂–Ω–æ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —Å –ø–æ–º–æ—â—å—é OnUpdate, –æ —á—ë–º —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ.

üìò –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π

  –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É–º–æ–∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –∞ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–ª –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è, –∏—Å–ø–æ–ª—å–∑—É—è —Å–æ–±—ã—Ç–∏–µ OnUpdate. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –∫–æ–¥ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º, –æ–±—Ä–∞—Ç–∏–≤ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ—Ç–ª–∏—á–∏—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏:
  
    if not BagWatchFrame then
      BagWatchFrame = CreateFrame("Frame")
    end
    
    BagWatchFrame.THROTTLE = 0.5
    BagWatchFrame.WARN_LEVEL = 0.2
    BagWatchFrame.message = "You are running low on bag space!"
    BagWatchFrame.fullMessage = "Your bags are full!"
  
    local function bagWatch_ScanBags(frame)
      local maxSlots, freeSlots = 0, 0
  
      for idx = 0, 4 do
        maxSlots = maxSlots + GetContainerNumSlots(idx)
        freeSlots = freeSlots + GetContainerNumFreeSlots(idx)
      end
      
      local percFree = freeSlots / maxSlots
      local msg
  
      if percFree == frame.percFree then
        -- –ù–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏
      elseif percFree == 0 then
        msg = frame.fullMessage
      elseif percFree <= frame.WARN_LEVEL then
        msg = frame.message
      end
  
      if msg then
        RaidNotice_AddMessage(RaidWarningFrame, msg, ChatTypeInfo["RAID_WARNING"])
      end
      frame.percFree = percFree
    end
    
    BagWatchFrame:RegisterEvent("BAG_UPDATE")
    local counter = 0
    
    BagWatchFrame:SetScript("OnUpdate", function(self, elapsed)
      counter = counter + elapsed
      if counter >= self.THROTTLE then
        bagWatch_ScanBags(self)
        counter = 0
        self:Hide()
      end
    end)
    
    BagWatchFrame:SetScript("OnEvent", function(self, event, ...)
      BagWatchFrame:Show()
    end)
    
  –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—É–º–æ–∫ –Ω–∞–ø—Ä—è–º—É—é (–∫–æ—Ç–æ—Ä–∞—è –∑–¥–µ—Å—å –±—ã–ª–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞), –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è OnEvent –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç :Show() –¥–ª—è BagWatchFrame, —á—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç OnUpdate. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–π–¥—ë—Ç –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ 0.5 —Å–µ–∫—É–Ω–¥—ã), –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–æ–∫. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ BAG_UPDATE —Å–æ–±—ã—Ç–∏–π –ø–æ–¥—Ä—è–¥, —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏.
  
üìò –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –∫–æ–¥ —Å –ø–æ–º–æ—â—å—é OnUpdate

  –°–∫—Ä–∏–ø—Ç—ã OnUpdate –º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–¥–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç—ã –º–æ–∂–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –∞–¥–¥–æ–Ω CombatTracker, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤ –≥–ª–∞–≤–µ 14, —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –æ–±–Ω–æ–≤–ª—è–ª –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤–æ –≤—Ä–µ–º—è –±–æ—è ‚Äî –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ü–µ –±–æ—è.
  
  –î–æ–±–∞–≤—å —Å–ª–µ–¥—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ CombatTracker.lua:
    local throttle = 1.0
    local counter = 0

    function CombatTracker_OnUpdate(self, elapsed)
      counter = counter + elapsed
      if counter >= throttle then
        CombatTracker_UpdateText()
        counter = 0
      end
    end
    
  –ó–∞—Ç–µ–º –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ OnUpdate –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –±–æ–π –∏ —É–±—Ä–∞—Ç—å –µ–≥–æ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –±–æ—è.
  –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ CombatTracker_OnEvent():
  
  –í –±–ª–æ–∫–µ PLAYER_REGEN_ENABLED –¥–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É:
    frame:SetScript("OnUpdate", nil)
    
  –í –±–ª–æ–∫–µ PLAYER_REGEN_DISABLED –¥–æ–±–∞–≤—å:
    frame:SetScript("OnUpdate", CombatTracker_OnUpdate)
    
  –¢–µ–ø–µ—Ä—å, –ø–æ–∫–∞ —Ç—ã –Ω–∞—Ö–æ–¥–∏—à—å—Å—è –≤ –±–æ—é, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–æ–≤ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É.

üìò –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ OnUpdate-—Å–∫—Ä–∏–ø—Ç—ã

  –ü–æ–º–Ω–∏, —á—Ç–æ –∫–æ–¥ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ OnUpdate –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä.
  –ï—Å–ª–∏ —É —Ç–µ–±—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, 60 –∫–∞–¥—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É, –∑–Ω–∞—á–∏—Ç, —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è 60 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É. –ü–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Ç–∞–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π. –ù–µ –Ω—É–∂–Ω–æ –ø–∞–Ω–∏–∫–æ–≤–∞—Ç—å –∏ –º–∏–∫—Ä–æ–º–µ–Ω–µ–¥–∂–µ—Ä–∏—Ç—å –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ—á–∫—É, –Ω–æ –ø–ª–æ—Ö–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è OnUpdate –º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ FPS.

  –û—Å–æ–±–µ–Ω–Ω–æ —Å—Ç–æ–∏—Ç –ø–æ–º–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:
    –ö–ª–∏–µ–Ω—Ç –∏–≥—Ä—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∏ –≤—Å–µ OnUpdate-—Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∏.

    –ï—Å–ª–∏ –Ω–µ—Ç –Ω—É–∂–¥—ã –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä, –∏—Å–ø–æ–ª—å–∑—É–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (throttle) ‚Äî –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ.

    –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ, —Ç–∞–∫ —á—Ç–æ —ç—Ç–æ –º–æ–∂–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –ø–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

üìò –ò—Ç–æ–≥
  –í —ç—Ç–æ–π –≥–ª–∞–≤–µ —Ç—ã —É–∑–Ω–∞–ª, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OnUpdate –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫ –∏–ª–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞.
  –ë—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –Ω–µ–±–æ–ª—å—à–∏–µ –∞–¥–¥–æ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ OnUpdate –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á.
  
  –í —Å–ª–µ–¥—É—é—â–µ–π –≥–ª–∞–≤–µ —Ç—ã —É–∑–Ω–∞–µ—à—å –æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–µ —Ñ—É–Ω–∫—Ü–∏–π (hooking) –∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–∞–π–º–µ—Ä–∞ OnUpdate —Å –ø–µ—Ä–µ—Ö–≤–∞—Ç–æ–º, —á—Ç–æ–±—ã –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–≥—Ä—ã.
    
    